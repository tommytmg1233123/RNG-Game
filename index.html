<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meme RNG Spin Game</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
  background: #87CEEB;
}

/* ===== WORLD (BACKGROUND GAME) ===== */
#world {
  position: fixed;
  inset: 0;
  z-index: 0;
}

#player {
  position: absolute;
  bottom: 20%;
  left: 50%;
  width: 12px;
  height: 35vh; /* ~3/5 screen height */
  transform: translateX(-50%);
}

.stick-head {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 5px solid black;
  margin: auto;
}

.stick-body {
  width: 6px;
  height: 60%;
  background: black;
  margin: auto;
}

/* ===== SPIN UI ===== */
#spinArea {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 900px;
  max-width: 95vw;
  z-index: 5;
}

#wheelContainer {
  position: relative;
  height: 140px;
  overflow: hidden;
  border-radius: 12px;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(6px);
}

#wheel {
  display: flex;
  height: 100%;
}

.segment {
  min-width: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.segment img {
  width: 90px;
  height: 90px;
  object-fit: contain;
}

/* Needle (TOP PIN) */
#needle {
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 25px solid red;
}

/* Buttons Bottom */
#controls {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 5;
}

.spinBtn {
  padding: 16px 40px;
  font-size: 22px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background: linear-gradient(180deg,#4faaff,#1c6fff);
  color: white;
  font-weight: bold;
}

.skipBtn {
  padding: 8px 25px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: #444;
  color: white;
}

/* Rarity flash */
#rarityFlash {
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  z-index: 20;
}

#rarityText {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  font-size: 60px;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 20px black;
  opacity: 0;
  z-index: 21;
}

#rollCounter {
  position: fixed;
  right: 20px;
  top: 20px;
  color: white;
  font-size: 18px;
  z-index: 10;
}

</style>
</head>

<body>

<canvas id="world"></canvas>

<div id="player">
  <div class="stick-head"></div>
  <div class="stick-body"></div>
</div>

<div id="spinArea">
  <div id="wheelContainer">
    <div id="needle"></div>
    <div id="wheel"></div>
  </div>
</div>

<div id="controls">
  <button class="spinBtn" onclick="startSpin()">SPIN</button>
  <button class="skipBtn" onclick="skipSpin()">SKIP</button>
</div>

<div id="rarityFlash"></div>
<div id="rarityText"></div>
<div id="rollCounter">Rolls: 0</div>

<script>

/* ===== MEME DATA (EDIT THIS TO ADD YOUR OWN) ===== */
const memes = [
  {name:"Common Dog", img:"https://i.imgur.com/JqeuJ6t.png", rarity:"Common", chance:70, color:"#888"},
  {name:"Rare Cat", img:"https://i.imgur.com/Qp9Z4KU.png", rarity:"Rare", chance:20, color:"#3b82f6"},
  {name:"Epic Frog", img:"https://i.imgur.com/4AiXzf8.jpeg", rarity:"Epic", chance:8, color:"#a855f7"},
  {name:"Legend Pepe", img:"https://i.imgur.com/4M34hi2.png", rarity:"Legendary", chance:1.9, color:"#f59e0b"},
  {name:"ULTRA GOD", img:"https://i.imgur.com/V4RclNb.png", rarity:"Ultra", chance:0.1, color:"#ff0000"}
];

/* ===== BUILD WHEEL ===== */
const wheel = document.getElementById("wheel");
let wheelData = [];

memes.forEach(m=>{
  let count = Math.max(1, Math.floor(m.chance));
  for(let i=0;i<count;i++) wheelData.push(m);
});

wheelData = [...wheelData,...wheelData,...wheelData,...wheelData];

wheelData.forEach(m=>{
  const seg = document.createElement("div");
  seg.className="segment";
  seg.style.boxShadow = `inset 0 0 25px ${m.color}`;
  seg.innerHTML=`<img src="${m.img}">`;
  wheel.appendChild(seg);
});

/* ===== SPIN LOGIC ===== */
let spinning=false;
let offset=0;
let speed=0;
let target=0;
let rolls=0;

function weightedPick(){
  let total=memes.reduce((a,b)=>a+b.chance,0);
  let r=Math.random()*total;
  let sum=0;
  for(let m of memes){
    sum+=m.chance;
    if(r<=sum) return m;
  }
  return memes[0];
}

function startSpin(){
  if(spinning) return;
  spinning=true;
  speed=80+Math.random()*40;
  const result=weightedPick();
  target = wheelData.indexOf(result) * 140 + 5000;
  animateSpin(result);
}

function skipSpin(){
  if(!spinning) return;
  offset = target;
}

function animateSpin(result){
  function frame(){
    offset += speed;
    speed *= 0.985;
    wheel.style.transform=`translateX(${-offset}px)`;

    if(speed<0.5 || offset>=target){
      spinning=false;
      finishSpin(result);
      return;
    }
    requestAnimationFrame(frame);
  }
  frame();
}

function finishSpin(m){
  rolls++;
  document.getElementById("rollCounter").innerText="Rolls: "+rolls;

  const flash=document.getElementById("rarityFlash");
  const text=document.getElementById("rarityText");

  flash.style.background=m.color;
  flash.style.opacity=0.5;
  text.innerText=m.rarity;
  text.style.opacity=1;

  setTimeout(()=>{
    flash.style.opacity=0;
    text.style.opacity=0;
  },1500);
}

/* ===== WORLD LOOP BACKGROUND ===== */
const canvas=document.getElementById("world");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
}
resize(); window.addEventListener("resize",resize);

let camX=0;
let keys={};

document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

function worldLoop(){
  if(keys['a']) camX-=5;
  if(keys['d']) camX+=5;

  ctx.fillStyle="#87CEEB";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let i=-2000;i<2000;i+=300){
    let x=i-camX;

    ctx.fillStyle="#3c9a3c";
    ctx.fillRect(x,canvas.height-120,60,120);

    ctx.beginPath();
    ctx.arc(x+30,canvas.height-140,60,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle="#4aa3ff";
    ctx.fillRect(x+150,canvas.height-60,200,40);
  }

  requestAnimationFrame(worldLoop);
}
worldLoop();

</script>

</body>
</html>
